# AUTOMATICALLY GENERATED
# DO NOT EDIT THIS FILE DIRECTLY. Edit /Dockerfile.erb and run /update instead.

FROM alpine:3.10

RUN set -ex \
      && apk add --no-cache --virtual .lua-builddeps \
      ca-certificates \
      curl \
      gcc \
      libc-dev \
      make \
                    coreutils \
        gnupg \
        unzip \
          && curl -fsSL -o /tmp/lua.tar.gz "https://luajit.org/download/LuaJIT-2.1.0-beta3.tar.gz" \
  && cd /tmp \
      && echo "1ad2e34b111c802f9d0cdf019e986909123237a28c746b21295b63c9e785d9c3 *lua.tar.gz" | sha256sum -c - \
    && mkdir /tmp/lua \
  && tar -xf /tmp/lua.tar.gz -C /tmp/lua --strip-components=1 \
  && cd /tmp/lua \
      && make CFLAGS="-DLUAJIT_ENABLE_LUA52COMPAT" \
    && make install \
      && ln -s /usr/local/bin/luajit-2.1.0-beta3 /usr/local/bin/luajit \
        && curl -fsSL -o /tmp/luarocks.tar.gz "https://luarocks.org/releases/luarocks-3.7.0.tar.gz" \
    && curl -fsSL -o /tmp/luarocks.tar.gz.asc "https://luarocks.org/releases/luarocks-3.7.0.tar.gz.asc" \
    && cd /tmp \
    && export GNUPGHOME="$(mktemp -d)" \
    && export GPG_KEYS="8460980B2B79786DE0C7FCC83FD8F43C2BB3C478" \
    && (gpg --batch --keyserver hkp://ha.pool.sks-keyservers.net:80 --recv-keys "$GPG_KEYS" || gpg --batch --keyserver hkp://ipv4.pool.sks-keyservers.net:80 --recv-keys "$GPG_KEYS" || gpg --batch --keyserver hkp://p80.pool.sks-keyservers.net:80 --recv-keys "$GPG_KEYS" || gpg --batch --keyserver hkp://keyserver.ubuntu.com:80 --recv-keys "$GPG_KEYS") \
    && gpg --batch --verify luarocks.tar.gz.asc luarocks.tar.gz \
    && rm -rf "$GNUPGHOME" \
    && mkdir /tmp/luarocks \
    && tar -xf /tmp/luarocks.tar.gz -C /tmp/luarocks --strip-components=1 \
    && cd /tmp/luarocks \
    && ./configure \
    && make \
    && make install \
    && cd / \
      && apk add --no-network --no-cache --virtual .lua-rundeps \
                    libgcc \
                    ca-certificates \
        coreutils \
        curl \
        unzip \
          && apk del --no-network .lua-builddeps \
    && rm -rf /tmp/lua /tmp/lua.tar.gz \
      && rm -rf /tmp/luarocks /tmp/luarocks.tar.gz \
    && luarocks --version \
    && luajit -v

CMD ["luajit"]
