#!/usr/bin/env bash
# AUTOMATICALLY GENERATED
# DO NOT EDIT THIS FILE DIRECTLY. Edit /publish.erb and run /publish instead.

set -Eeuo pipefail

echo "$DOCKERHUB_PASS" | docker login -u "$DOCKERHUB_USERNAME" --password-stdin

set -x
<% tags.each do |lang, files| -%>

image_name="nickblah/<%= lang %>"
<% files.each do |file, file_tags| -%>

primary_tag="<%= file_tags.fetch(:primary_tag) %>"
docker build -t "$image_name:$primary_tag" <%= File.dirname(file) %>
docker push "$image_name:$primary_tag"
<% file_tags.fetch(:secondary_tags).each do |tag| -%>
docker tag "$image_name:$primary_tag" "$image_name:<%= tag %>"
docker push "$image_name:<%= tag %>"
<% end -%>
<% end -%>
<% end -%>

